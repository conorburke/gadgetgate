# Migration `20191125123226-initial_tool_schema`

This migration has been generated by conorburke at 11/25/2019, 12:32:26 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "dev"."User" (
  "birth_date" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "email" text NOT NULL DEFAULT '' ,
  "first_name" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "last_name" text NOT NULL DEFAULT '' ,
  "password_hash" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "dev"."Post" (
  "content" text   ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "published" boolean NOT NULL DEFAULT true ,
  "title" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "dev"."Email" (
  "address" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "purpose" text   ,
  PRIMARY KEY ("id")
);

CREATE TABLE "dev"."Phone" (
  "id" text NOT NULL  ,
  "num" text NOT NULL DEFAULT '' ,
  "purpose" text   ,
  PRIMARY KEY ("id")
);

CREATE TABLE "dev"."Rating" (
  "comment" text   ,
  "id" text NOT NULL  ,
  "point" integer NOT NULL DEFAULT 0 ,
  "type" text NOT NULL DEFAULT 'Loaner' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "dev"."Depot" (
  "address_1" text NOT NULL DEFAULT '' ,
  "address_2" text   ,
  "city" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "state" text NOT NULL DEFAULT '' ,
  "zipcode" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "dev"."Tool" (
  "category" text NOT NULL DEFAULT '' ,
  "description" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "price" Decimal(65,30) NOT NULL DEFAULT 0 ,
  "title" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "dev"."ToolPicture" (
  "description" text   ,
  "id" text NOT NULL  ,
  "image" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "dev"."RentedTool" (
  "end_date" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "start_date" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

ALTER TABLE "dev"."Post" ADD COLUMN "author" text   REFERENCES "dev"."User"("id") ON DELETE SET NULL;

ALTER TABLE "dev"."Email" ADD COLUMN "owner" text   REFERENCES "dev"."User"("id") ON DELETE SET NULL;

ALTER TABLE "dev"."Phone" ADD COLUMN "owner" text   REFERENCES "dev"."User"("id") ON DELETE SET NULL;

ALTER TABLE "dev"."Rating" ADD COLUMN "user" text   REFERENCES "dev"."User"("id") ON DELETE SET NULL;

ALTER TABLE "dev"."Depot" ADD COLUMN "owner" text   REFERENCES "dev"."User"("id") ON DELETE SET NULL;

ALTER TABLE "dev"."Tool" ADD COLUMN "depot" text   REFERENCES "dev"."Depot"("id") ON DELETE SET NULL;

ALTER TABLE "dev"."ToolPicture" ADD COLUMN "tool" text   REFERENCES "dev"."Tool"("id") ON DELETE SET NULL;

ALTER TABLE "dev"."RentedTool" ADD COLUMN "renter" text   REFERENCES "dev"."User"("id") ON DELETE SET NULL,
ADD COLUMN "tool" text   REFERENCES "dev"."Tool"("id") ON DELETE SET NULL;

CREATE UNIQUE INDEX "User.email" ON "dev"."User"("email")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20191125123226-initial_tool_schema
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,97 @@
+generator photon {
+  provider = "photonjs"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = "postgresql://postgres:postgres@localhost:5432/postgres?schema=dev"
+}
+
+model User {
+  id             String   @default(cuid()) @id
+  password_hash  String
+  email          String   @unique
+  first_name     String
+  last_name      String
+  birth_date     DateTime
+  emails         Email[]
+  phones         Phone[]
+  depots         Depot[]
+  // loaner_ratings Rating[] @relation(name: "LoanerRatings")
+  // buyer_ratings  Rating[] @relation(name: "BuyerRatings")
+}
+
+
+
+model Post {
+  id        String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  published Boolean  @default(true)
+  title     String
+  content   String?
+  author    User?
+}
+
+model Email {
+  id      String  @default(cuid()) @id
+  address String
+  purpose String?
+  owner   User
+}
+
+model Phone {
+  id      String  @default(cuid()) @id
+  num     String
+  purpose String?
+  owner   User
+}
+
+model Rating {
+  id      String  @default(cuid()) @id
+  point   Int
+  type    RatingType
+  comment String?
+  user    User
+}
+
+enum RatingType {
+  Loaner
+  Renter
+}
+
+model Depot {
+  id        String  @default(cuid()) @id
+  address_1 String
+  address_2 String?
+  city      String
+  state     String
+  zipcode   String
+  owner     User
+  tools     Tool[]
+}
+
+model Tool {
+  id          String        @default(cuid()) @id
+  title       String
+  category    String
+  description String
+  price       Float
+  depot       Depot
+  pictures    ToolPicture[]
+}
+
+model ToolPicture {
+  id          String  @default(cuid()) @id
+  image       String
+  description String?
+  tool        Tool
+}
+
+model RentedTool {
+  id         String   @default(cuid()) @id
+  tool       Tool
+  renter     User
+  start_date DateTime
+  end_date   DateTime
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20191125123226-initial_tool_schema)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191125123226-initial_tool_schema'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
